const BASE_URL=window.location.origin,preloader=document.querySelector(".lds-ring"),hamburger=document.querySelector(".hamburger"),mainMenu=document.querySelector(".main-menu"),topArrow=document.querySelector(".top-arrow"),aphorismsContainer=document.querySelector(".aphorisms-container"),moreButtonAphorism=document.querySelector(".more-button-aphorism"),filterByTopic=document.getElementById("filter-by-topic"),filterByCategories=document.getElementById("filter-by-categories"),filterByAuthor=document.getElementById("filter-by-author"),preloaderNone=()=>preloader.style.display="none";"visible"===sessionStorage.getItem("mainMenu")&&(hamburger.classList.toggle("change"),mainMenu.classList.toggle("main-menu-active"));const funcRequest=(e,t)=>{preloader.style.display="block",moreButtonAphorism.style.display="block",fetch(`${BASE_URL}/${e}`).then(e=>e.json()).then(e=>{preloaderNone(),t(e)}).catch(e=>{preloaderNone(),console.log(e)})};hamburger.addEventListener("click",()=>{hamburger.classList.toggle("change"),mainMenu.classList.toggle("main-menu-active"),"visible"===sessionStorage.getItem("mainMenu")?sessionStorage.setItem("mainMenu","invisible"):sessionStorage.setItem("mainMenu","visible")});const templateItemAphorism=e=>{let t='<section class="aphorisms-container"><div class="lds-ring"><div></div><div></div><div></div><div></div></div>';return e.forEach((e,n)=>{t+=`<div class="aphorisms-item">\n                      <div class="aphorisms-tags">${e.tags[0]&&e.tags.map(e=>`<span>${e.name}</span>`).join("")}\n                      </div>\n                      <div class="aphorisms-item-body">\n                        <p>${e.body}</p>\n                      </div>\n                      <div class="aphorisms-item-bottom">\n                        <div class="aphorisms-authors">\n                          <span>${e.author}</span>\n                        </div>\n                        <div class="aphorisms-icons">\n                          <i name="${n}" id="fa-clone" class="fa fa-clone" aria-hidden="true"></i>\n                          <i name="${n}" id="fa-share" class="fa fa-share-alt" aria-hidden="true"></i>\n                        </div>\n                      </div>\n                    </div>\n                      `}),t+="</section>",t},loadingTemplateAphorism=e=>{let t;return e.forEach((e,n)=>{t+=`<div class="aphorisms-item">\n                      <div class="aphorisms-tags">${e.tags[0]&&e.tags.map(e=>`<span>${e.name}</span>`).join("")}\n                      </div>\n                      <div class="aphorisms-item-body">\n                        <p>${e.body}</p>\n                      </div>\n                      <div class="aphorisms-item-bottom">\n                        <div class="aphorisms-authors">\n                          <span>${e.author}</span>\n                        </div>\n                        <div class="aphorisms-icons">\n                          <i name="${n}" id="fa-clone" class="fa fa-clone" aria-hidden="true"></i>\n                          <i name="${n}" id="fa-share" class="fa fa-share-alt" aria-hidden="true"></i>\n                        </div>\n                      </div>\n                    </div>\n                      `}),t};if(filterByTopic&&(filterByTopic.addEventListener("change",()=>{funcRequest(`admin/aphorisms?topic=${event.target.value}&random=false`,({data:e})=>{aphorismsContainer.innerHTML=templateItemAphorism(e)})}),filterByCategories.addEventListener("change",()=>{funcRequest(`admin/aphorisms?category=${event.target.value}&random=false`,({data:e})=>{aphorismsContainer.innerHTML=templateItemAphorism(e)})}),filterByAuthor.addEventListener("change",()=>{funcRequest(`admin/aphorisms?author=${event.target.value}&random=false`,({data:e})=>{aphorismsContainer.innerHTML=templateItemAphorism(e)})})),moreButtonAphorism){let e=0;moreButtonAphorism.addEventListener("click",()=>{e++,funcRequest(`admin/aphorisms?random=false&offset=${100*e}&limit=100`,e=>{let t=document.createRange().createContextualFragment(loadingTemplateAphorism(e.data));aphorismsContainer.appendChild(t),e.count<100&&(moreButtonAphorism.value=moreButtonAphorism.value.replace("100",e.count)),e.count||(moreButtonAphorism.style.display="none")})})}topArrow&&(topArrow.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"})),window.addEventListener("click",(function(e){e.target.closest(".fa-clone")&&(console.log("============================="),console.log("logging",e.target.closest(".fa-clone")),console.log("============================="))})),window.addEventListener("scroll",e=>{window.pageYOffset>600?topArrow.style.display="block":topArrow.style.display="none"}),window.pageYOffset>600&&(topArrow.style.display="block"));const subscribeInput=document.querySelector(".subscribe-input"),subscribeButton=document.querySelector(".subscribe-button");subscribeButton.addEventListener("click",e=>{e.preventDefault();const t={email:subscribeInput.value};fetch("http://spiritual-evolution.ru/user/subscribeEmail",{method:"POST",body:JSON.stringify(t)}).then(e=>e.ok?e:Promise.reject(e)).then(()=>alert("Подписка оформлена")).catch(()=>alert("Произошла ошибка, попробуйте снова"))});
